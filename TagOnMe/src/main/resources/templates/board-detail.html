<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">

<head>
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1.0" name="viewport">

<title th:text="${board.title}"></title>
<meta content="" name="description">
<meta content="" name="keywords">

<!-- Favicons -->
<link href="/bootstrap/assets/img/favicon.png" rel="icon">
<link href="/bootstrap/assets/img/apple-touch-icon.png" rel="apple-touch-icon">

<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Roboto:300,300i,400,400i,500,500i,700,700i&display=swap" rel="stylesheet">

<!-- Vendor CSS Files -->
<link href="/bootstrap/assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
<link href="/bootstrap/assets/vendor/animate.css/animate.min.css" rel="stylesheet">
<link href="/bootstrap/assets/vendor/icofont/icofont.min.css" rel="stylesheet">
<link href="/bootstrap/assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
<link href="/bootstrap/assets/vendor/venobox/venobox.css" rel="stylesheet">
<link href="/bootstrap/assets/vendor/aos/aos.css" rel="stylesheet">

<!-- Template Main CSS File -->
<link href="/bootstrap/assets/css/style.css" rel="stylesheet">

<!-- =======================================================
  * Template Name: Moderna - v2.2.1
  * Template URL: https://bootstrapmade.com/free-bootstrap-template-corporate-moderna/
  * Author: BootstrapMade.com
  * License: https://bootstrapmade.com/license/
  ======================================================== -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>

<link rel="stylesheet" href="/board/css/style.css" />
<link rel="stylesheet" href="/board/plugin/mCustomScrollbar/jquery.mCustomScrollbar.min.css" />
<link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
<script src="https://code.jquery.com/jquery-1.12.4.js"></script>

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

<script src="/board/scripts/jquery.min.js?after"></script>
<script src="/board/plugin/bootstrap/js/bootstrap.min.js?after"></script>
<script src="/board/plugin/mCustomScrollbar/jquery.mCustomScrollbar.concat.min.js?after"></script>
<script src="/board/plugin/common/moment.js?after"></script>

<script src="/board/scripts/main.js?after"></script>
<script src="/board/scripts/common.js?after"></script>

 <style>
 
 body {
 	font-size: 14px;
 }
 
 ul, li {
	list-style: none;
}
  .tags {
	margin-bottom: 30px;
}

.tags ul {
	list-style: none;
	padding: 0;
}

.tags ul li {
	display: inline-block;
}

.tags ul a {
	color: #444;
	font-size: 14px;
	padding: 6px 14px;
	margin: 2px 6px 2px 0;
	border: 1px solid #888;
	display: inline-block;
	transition: 0.3s;
	border-radius: 50px;
}

.tags ul a:hover {
	color: #fff;
	border: 1px solid #029CEB;
	background: #029CEB;
}

.tags ul a span {
	padding-left: 5px;
	color: #bedae8;
	font-size: 14px;
}
.tags ul button {
  color: #444;
  font-size: 14px;
  padding: 6px 14px;
  margin: 0 6px 8px ;
  border: 1px solid #888;
  display: inline-block;
  transition: 0.3s;
  border-radius: 50px;
  background:none;
}

.tags ul button:hover {
  color: #fff;
  border: 1px solid #029CEB;
  background: #029CEB;
}
  </style>
</head>

<body>

	<!-- ======= Header ======= -->
	<header id="header" class="fixed-top header-transparent">
		<div class="container">

			<div class="logo float-left">
				<h1 class="text-light">
					<a href="index.html"><span>Tag on me!</span></a>
				</h1>
			</div>

			 <nav class="nav-menu float-right d-none d-lg-block">
				<ul>
					<li class="active"><a href="">Home</a></li>
					<li><a href="/board/list.do">게시판</a></li>
					<li><a href="/member/memberinfo">로그인</a></li>
					<li><a href="/member/memberjoin">회원가입</a></li>
					<li><a href="/room" target="_black">채팅</a></li>
					<li class="drop-down">
						<a href="">내 정보</a>
						<ul>
							<li><a href="/member/openProfileList.do">내 프로필</a></li>
							<li><a href="/member/updateProfile.do">프로필 수정</a></li>
							<li><a href="#">태그 추가</a></li>
							<li><hr> <a href="#">로그 아웃</a></li>
						</ul>
					</li>
				</ul>
			</nav>
			<!-- .nav-menu -->
		</div>
	</header>
	<!-- End Header -->

	<main id="main">

		<!-- ======= Blog Section ======= -->
		<section class="breadcrumbs">
			<div class="container">

				<div class="d-flex justify-content-between align-items-center">
					<h2>Blog</h2>

					<ol>
						<li><a href="index.html">Home</a></li>
						<li><a href="blog.html">Blog</a></li>
						<li>게시글</li>
					</ol>
				</div>

			</div>
		</section>
		<!-- End Blog Section -->
			
		<!-- ======= Blog Section ======= -->
		<section class="blog" data-aos="fade-up" data-aos-easing="ease-in-out"
			data-aos-duration="500">
			<div class="container">

				<div class="row">

					<div class="col-lg-12 entries">

						<article class="entry entry-single" th:object="${board}">


							<h2 class="entry-title">
								<a href="blog-single.html" th:text="*{title}"></a>
							</h2>

							<div class="entry-meta">
								<ul>
									<li class="d-flex align-items-center drop-down">
					                  	<i class="icofont-user"></i> 
					                  	<a href="" th:text=*{writer}></a>
					                  	<ul>
											<li><a th:href="|@{/member/openProfileList.do/{writer}(writer=*{writer})}|">프로필</a></li>
											<li th:if="${member} != 'null'">
												<a href="#" th:onclick="goRoom([[*{writer}]] ,[[ ${member.userid} ]] )" >채팅</a>
											</li>
											<li th:unless="${member} != 'null'"></li>
										</ul>
					                  </li>
									</li>
									<li class="d-flex align-items-center">
										<i class="icofont-wall-clock"></i>
										<a href="" th:text="*{#temporals.format( regDate, 'yyyy-MM-dd' )}"></a>
									</li>
									<li class="d-flex align-items-center">
										<i class="icofont-comment"></i>
										<a href="" th:text="*{replyCnt}"></a>
									</li>
									<li class="d-flex align-items-center">
										<i class="icofont-comment"></i>
										<ul th:each="getTag : ${openTagList}">
											<ul th:each="getTagName : ${getTag.tagNameList}" th:text="${getTagName.tags}"> </ul>
										</ul>
									</li>
								</ul>
							</div>

							<div class="entry-content" th:text="*{content}"></div>

							<div th:if="${not #lists.isEmpty( fileList )}" class="form-group">
								<div class="form-control file_list">
									<a th:each="row, status : ${fileList}" th:href="@{/board/download.do( bno=${row.bno} )}"> [[ ${row.originalName} ]] </a>
								</div>
							</div>


							<div class="entry-footer clearfix" th:if="${member}!='null' and ${member.userid.equals(board.writer)}">
								<a th:href="|@{/board/write.do}*{makeQueryString(currentPageNo)}&bno=${board.bno}|" class="btn btn-primary waves-effect waves-light">수정하기</a>
								<button type="button" class="btn btn-danger waves-effect waves-light" th:onclick="deleteBoard([[ ${board.bno} ]], [[ *{makeQueryString(currentPageNo)} ]])">삭제하기</button>	
							</div>

							<div th:unless="${member}!='null' and ${member.userid.equals(board.writer)}"></div>

						</article>
						<!-- End blog entry -->

						<div class="blog-comments">

							<ul class="notice-list"></ul>

							<div class="reply-form">
								<h4>Reply</h4>
								<h1></h1>
								<form th:if="${member}!='null'">
									<div class="row">
										<div class="col-md-12 form-group">
											<input id="name" type="text" class="form-control"
												th:value="${member.userid}" readonly>
										</div>
									</div>
									<div class="row">
										<div class="col form-group">
											<textarea id="content" class="form-control"></textarea>
										</div>
									</div>
									<button type="submit" class="btn btn-primary" th:data-val="${board.bno}" id="btnReply">Post Reply</button>
								</form>
								<div th:unless="${member}!='null'">
									<p>댓글을 달려면 로그인이 필요합니다</p>
								</div>
							</div>

						</div>
						<!-- End blog comments -->

					</div>
					<!-- End blog entries list -->

				</div>
				<!-- End row -->

			</div>
			<!-- End container -->

		</section>
		<!-- End Blog Section -->

	</main>
	<!-- End #main -->

	<script th:inline="javascript">
    /*<![CDATA[*/
    	
    $(function () {
      printReplyList();
           
    });
    
	function openModal(rno, replyer, reply) {

		$("#replyModal").modal("toggle");

		document.getElementById("modalReplyer").value = replyer;
		document.getElementById("modalReply").value = reply;

		document.getElementById("btnReplyUpdate").setAttribute("onclick", "updateReply("+ rno +")");
		document.getElementById("btnReplyDelete").setAttribute("onclick", "deleteReply("+ rno +")");
	}
    	
    $(document).ready(function(){
    	
    	$('#btnReply').click(function(e){
    		e.preventDefault();
 		    var name = document.getElementById("name");
 		    var content = document.getElementById("content");

 		    if (isEmpty(content.value) == true) {
 		      content.setAttribute("placeholder", "댓글을 입력해 주세요.");
 		      content.focus();
 		      return false;
 		    }

    		var bno = $('#btnReply').attr("data-val");
 		    var uri = /*[[ @{/replys} ]]*/;
 		    var headers = { "Content-Type": "application/json", "X-HTTP-Method-Override": "POST" };
 		    var params = { "bno": bno, "reply": content.value, "replyer": name.value };
 		       			
 		    $.ajax({
 		      url: uri,
 		      type: "POST",
 		      headers: headers,
 		      dataType: "json",
 		      data: JSON.stringify(params),
 		      success: function (response) {
 		        if (response.result == false) {
 		          alert("댓글 등록에 실패하였습니다.");
 		          return false;
 		        }
 		        printReplyList();
 		          content.value = "";
 		      },
 		      error: function (xhr, status, error) {
 		        alert("에러가 발생하였습니다.");
 		        return false;
 		      }
 		    });
    	});
    	
    	  	
    }); //Documents Ready End
    
    function updateReply(rno) {

		var replyer = document.getElementById("modalReplyer");
		var reply = document.getElementById("modalReply");
	
		var uri = [[ @{/replys/} ]] + rno;
		var headers = {"Content-Type": "application/json", "X-HTTP-Method-Override": "PATCH"};
		var params = {"rno": rno, "replyer": replyer.value, "reply": reply.value};
	
		$.ajax({
			url: uri,
			type: "PATCH",
			headers: headers,
			dataType: "json",
			data: JSON.stringify(params),
			success: function(response) {
				if (response.result == false) {
					alert("댓글 수정에 실패하였습니다.");
					return false;
				}
	
				printReplyList();
				$("#replyModal").modal("hide");
			},
			error: function(xhr, status, error) {
				alert("에러가 발생하였습니다.");
				return false;
			}
		});
	}
	/*[- end of function -]*/

	function deleteReply(rno) {

		if (!confirm('댓글을 삭제하시겠어요?')) {
			return false;
		}
		
		var uri = [[ @{/replys/} ]] + rno;
		var headers = {"Content-Type": "application/json", "X-HTTP-Method-Override": "DELETE"};
	
		$.ajax({
			url: uri,
			type: "DELETE",
			headers: headers,
			dataType: "json",
			success: function(response) {
				if (response.result == false) {
					alert("댓글 삭제에 실패하였습니다.");
					return false;
				}
	
				printReplyList();
				$("#replyModal").modal("hide");
			},
			error: function(xhr, status, error) {
				alert("에러가 발생하였습니다.");
				return false;
			}
		});
	}
 
    function printReplyList() {

      var uri = /*[[ @{/replys/} + ${board.bno} ]]*/;

      $.get(uri, function (response) {
        if ($.isEmptyObject(response) == false) {
          var replysHtml = "";

          $(response.replyList).each(function (bno, replys) {
            replysHtml += `
				<div id="comment-1" class="comment clearfix">
					<h5>${replys.replyer}</h5>
					<time>${moment(replys.regDate).format('YYYY-MM-DD HH:mm:ss')}</time>
					<p>${replys.reply}</p>
					<button type="button" onclick="openModal('${replys.rno}', '${replys.replyer}', '${replys.reply}' )" class="btn btn-xs btn-circle">
						<i class="glyphicon glyphicon-pencil" aria-hidden="true"></i>
					</button>
				</div>
			`;
          });

          $(".notice-list").html(replysHtml);
        }
      }, "json");
    }
    
/* ============= < 채팅 > ============================================================================================ */
    
	var liveRoomList = []; // [] = new Array();

function Room(roomNumber, roomName){
	this.roomNumber = roomNumber;
	this.roomName = roomName;
	this.toString = function (){
		return 'roomNumber:' + this.roomNumber + ' /roomName:' + this.roomName;
	};
}

$(document).ready(function(){
});	

function getRoomList(){
	var usession = [[${me}]];
	console.log("로그인한 아이디 : " + usession);
	
	commonAjax('/getAllRoom', "", 'post', function(result){
		if(result != null){
			result.forEach(function(data, idx){
                console.log("From Server:" + ++idx + " 방번호:" + data.roomName.trim() + "/" + data.roomNumber);
			});
		}
	});
}

function createRoom(roomName){
	var msg = {roomName: roomName};

	commonAjax('/createRoom', msg, 'post', function(result){
		if(result != null){
			console.log(result);
			liveRoomList.push(new Room(result, roomName));
			printRoomList();
		}
	});
}

 function goRoom(you, me){
	
	let name = (you < me) ? you + "_" + me : me + "_" + you;
	let msg = {roomName: name};

	commonAjax('/getRoom', msg, 'post', function(result){
        console.log("result: " +result);
		makeRoom(msg, result);
	});
} 


function makeRoom(msg, result){
	if(result == undefined || result == null || result == ''){	//방
		commonAjax('/createRoom', msg, 'post', function(res){
			console.log("name: "+ res.roomName + "/number: "+res.roomNumber);
			location.href = "/moveChatting?roomName="+res.roomName+"&"+"roomNumber="+res.roomNumber;
		});
	} else {
        location.href = "/moveChatting?roomName=" + result.roomName + "&" + "roomNumber=" + result.roomNumber;
	}	
} 



function commonAjax(url, parameter, type, calbak, contentType){
	$.ajax({
		url: url,
		data: parameter,
		type: type,
		contentType : contentType!=null?contentType:'application/x-www-form-urlencoded; charset=UTF-8',
		success: function (res) {
			calbak(res);
		},
		error : function(err){
			console.log('error');
			calbak(err);
		}
	});
}
    
    
  	/*[- end of function -]*/
    /*]]>*/
  </script>

	<!-- ======= Footer ======= -->
	<footer id="footer" data-aos="fade-up" data-aos-easing="ease-in-out"
		data-aos-duration="500">

		<div class="footer-newsletter">
			<div class="container">
				<div class="row">
					<div class="col-lg-6">
						<h4>Our Newsletter</h4>
						<p>Tamen quem nulla quae legam multos aute sint culpa legam
							noster magna</p>
					</div>
					<div class="col-lg-6">
						<form action="" method="post">
							<input type="email" name="email"><input type="submit"
								value="Subscribe">
						</form>
					</div>
				</div>
			</div>
		</div>

		<div class="footer-top">
			<div class="container">
				<div class="row">

					<div class="col-lg-3 col-md-6 footer-links">
						<h4>Useful Links</h4>
						<ul>
							<li><i class="bx bx-chevron-right"></i> <a href="#">Home</a></li>
							<li><i class="bx bx-chevron-right"></i> <a href="#">About
									us</a></li>
							<li><i class="bx bx-chevron-right"></i> <a href="#">Services</a></li>
							<li><i class="bx bx-chevron-right"></i> <a href="#">Terms
									of service</a></li>
							<li><i class="bx bx-chevron-right"></i> <a href="#">Privacy
									policy</a></li>
						</ul>
					</div>

					<div class="col-lg-3 col-md-6 footer-links">
						<h4>Our Services</h4>
						<ul>
							<li><i class="bx bx-chevron-right"></i> <a href="#">Web
									Design</a></li>
							<li><i class="bx bx-chevron-right"></i> <a href="#">Web
									Development</a></li>
							<li><i class="bx bx-chevron-right"></i> <a href="#">Product
									Management</a></li>
							<li><i class="bx bx-chevron-right"></i> <a href="#">Marketing</a></li>
							<li><i class="bx bx-chevron-right"></i> <a href="#">Graphic
									Design</a></li>
						</ul>
					</div>

					<div class="col-lg-3 col-md-6 footer-contact">
						<h4>Contact Us</h4>
						<p>
							A108 Adam Street <br> New York, NY 535022<br> United
							States <br> <br> <strong>Phone:</strong> +1 5589 55488
							55<br> <strong>Email:</strong> info@example.com<br>
						</p>

					</div>

					<div class="col-lg-3 col-md-6 footer-info">
						<h3>About Moderna</h3>
						<p>Cras fermentum odio eu feugiat lide par naso tierra. Justo
							eget nada terra videa magna derita valies darta donna mare
							fermentum iaculis eu non diam phasellus.</p>
						<div class="social-links mt-3">
							<a href="#" class="twitter"><i class="bx bxl-twitter"></i></a> <a
								href="#" class="facebook"><i class="bx bxl-facebook"></i></a> <a
								href="#" class="instagram"><i class="bx bxl-instagram"></i></a>
							<a href="#" class="linkedin"><i class="bx bxl-linkedin"></i></a>
						</div>
					</div>

				</div>
			</div>
		</div>

		<div class="container">
			<div class="copyright">
				&copy; Copyright <strong><span>Moderna</span></strong>. All Rights
				Reserved
			</div>
			<div class="credits">
				<!-- All the links in the footer should remain intact. -->
				<!-- You can delete the links only if you purchased the pro version. -->
				<!-- Licensing information: https://bootstrapmade.com/license/ -->
				<!-- Purchase the pro version with working PHP/AJAX contact form: https://bootstrapmade.com/free-bootstrap-template-corporate-moderna/ -->
				Designed by <a href="https://bootstrapmade.com/">BootstrapMade</a>
			</div>
		</div>
	</footer>
	<!-- End Footer -->
	
	<div id="replyModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="commentModalLabel" aria-hidden="true" th:if="${member} != 'null'">
	    <div class="modal-dialog" role="document">
	        <div class="modal-content">
	            <div class="modal-header">
	                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
	                <span aria-hidden="true">&times;</span>
	                </button>
	            </div>
	            <div class="modal-body">
	                <form>
	                    <div class="form-group">
	                        <label for="modalReplyer" class="col-form-label">작성자</label>
	                        <input type="text" id="modalReplyer" th:if="${member} != 'null'"class="form-control" th:value="${replyDTO}" readonly/>
	                        <input type="text" id="modalReplyer" th:unless="${member} != 'null'"class="form-control" placeholder="작성자를 입력해 주세요"/>
	                    </div>
	                    <div class="form-group">
	                        <label for="modalReply" class="col-form-label">내용</label>
	                        <textarea id="modalReply" class="form-control" placeholder="내용을 입력해 주세요"></textarea>
	                    </div>
	                </form>
	            </div>
	            <div class="modal-footer">
	                <button type="button" id="btnModalCancel" class="btn btn-default waves-effect waves-light" data-dismiss="modal">취소하기</button>
	                <button type="button" id="btnReplyUpdate" class="btn btn-primary waves-effect waves-light" onclick="updateReply()">수정하기</button>
	                <button type="button" id="btnReplyDelete" class="btn btn-danger waves-effect waves-light" onclick="deleteReply()">삭제하기</button>
	            </div>
	        </div>
	    </div>
	</div>
	
	<div id="replyModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="commentModalLabel" aria-hidden="true" th:unless="${member} != 'null'">
		<div class="modal-dialog" role="document">
	        <div class="modal-content">
	            <div class="modal-header">
	                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
	                <span aria-hidden="true">&times;</span>
	                </button>
	            </div>
	            <div class="modal-body">
	                <p>로그인 먼저 부탁드립니다 ^^</p>
	            </div>
	        </div>
	    </div>
	</div>

	<a href="#" class="back-to-top"><i class="icofont-simple-up"></i></a>

	<!-- Vendor JS Files -->
	<script src="/bootstrap/assets/vendor/jquery/jquery.min.js"></script>
	<script
		src="/bootstrap/assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
	<script
		src="/bootstrap/assets/vendor/jquery.easing/jquery.easing.min.js"></script>
	<script src="/bootstrap/assets/vendor/php-email-form/validate.js"></script>
	<script src="/bootstrap/assets/vendor/venobox/venobox.min.js"></script>
	<script
		src="/bootstrap/assets/vendor/waypoints/jquery.waypoints.min.js"></script>
	<script src="/bootstrap/assets/vendor/counterup/counterup.min.js"></script>
	<script src="/bootstrap/assets/vendor/owl.carousel/owl.carousel.min.js"></script>
	<script
		src="/bootstrap/assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
	<script src="/bootstrap/assets/vendor/aos/aos.js"></script>

	<!-- Template Main JS File -->
	<script src="/bootstrap/assets/js/main.js"></script>
	
	
</body>

</html>